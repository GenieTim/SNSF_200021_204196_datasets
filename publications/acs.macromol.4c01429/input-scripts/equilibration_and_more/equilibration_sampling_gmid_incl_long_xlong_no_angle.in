#LAMMPS input file: Calculate the modulus from autocorrelation

units           lj
atom_style      angle
special_bonds   fene

bond_style      fene

pair_style	lj/cut 1.12246
angle_style zero nocoeff
echo both

read_data       &structure-file

neighbor        0.75 bin
neigh_modify    every 3 delay 0 check yes

bond_coeff	1 30.0 1.5 1.0 1.0
angle_coeff *
pair_coeff  * * 1.0 1.0 1.12246
pair_modify     shift yes

fix             1 all nve
fix             2 all langevin 1.0 1.0 0.5 394710 # zero yes

# prevent errors due to missing angle atoms
comm_modify     mode single cutoff 3.2 vel yes

timestep 0.01 # 0.006

# some additional computes
compute moleculeChunks all chunk/atom molecule
compute moleculeGyration all gyration/chunk moleculeChunks
compute moleculeMsd all msd/chunk moleculeChunks
compute moleculeCom all com/chunk moleculeChunks

group centralBeads type 5

restart 100000 &output-folder/&output-basename.restart-1.out &output-folder/&output-basename.restart-2.out

# equilibration
run 50000000 # 5e7
comm_modify     mode single cutoff 2.9 vel no
run 50000000 # 5e7

# after first run, we can reduce comm req.
comm_modify     mode single cutoff 2.5 vel no

fix 99 all ave/time 1 2000 2000 c_moleculeGyration c_moleculeMsd[*] c_moleculeCom[*] file &output-folder/&output-basename.out.vec-avg.txt mode vector

# compute stresses
compute pA all pressure thermo_temp

thermo_style    custom step temp vol press c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] 
thermo 500

variable nxy equal c_pA[1]-c_pA[2]
variable nxz equal c_pA[1]-c_pA[3]
variable nyz equal c_pA[2]-c_pA[3]

# output coordinates in order to later compute the g_mid
dump		1 all custom 750000 &output-folder/&output-basename.dump.out id type x y z ix iy iz # id = atom id, type = atom type, (x|y|z)su are coordinates without periodic boundary scaled by box size
dump		2 centralBeads custom 10 &output-folder/&output-basename.cm-dump.out id type x y z ix iy iz # id = atom id, type = atom type, (x|y|z)su are coordinates without periodic boundary scaled by box size

fix 5 all ave/correlate/long 1 500000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz type auto nlen 16 ncount 2 ncorr 30 file &output-folder/&output-basename.out.correlate-withkin.txt
fix 7 all ave/time 1 5000 5000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz mode scalar ave one file &output-folder/&output-basename.out.ave-withkin.txt


dump_modify 2 every 1 append yes
run 5000 # 5e3
dump_modify 2 every 10 append yes
run 50000 # 5e4
dump_modify 2 every 100 append yes
run 500000 # 5e5
dump_modify 2 every 1000 append yes
run 5000000 # 5e6
dump_modify 2 every 10000 append yes
run 94445000 # -> 1e8 sampling
# run 100000001 # 1e8 sampling

unfix 5
unfix 7

fix 6 all ave/correlate/long 1 500000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz type auto nlen 16 ncount 2 ncorr 30 file &output-folder/&output-basename_long.out.correlate-withkin.txt
fix 8 all ave/time 1 5000 5000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz mode scalar ave one file &output-folder/&output-basename_long.out.ave-withkin.txt

run 200000001 # 2e8 sampling
dump_modify 2 every 10000 append yes

unfix 6
unfix 8

fix 7 all ave/correlate/long 1 500000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz type auto nlen 16 ncount 2 ncorr 30 file &output-folder/&output-basename_xlong.out.correlate-withkin.txt
fix 9 all ave/time 1 5000 5000 c_pA[1] c_pA[2] c_pA[3] c_pA[4] c_pA[5] c_pA[6] v_nxy v_nxz v_nyz mode scalar ave one file &output-folder/&output-basename_xlong.out.ave-withkin.txt

run 400000001 # 4e8 sampling
