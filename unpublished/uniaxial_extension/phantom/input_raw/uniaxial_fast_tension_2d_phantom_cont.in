#LAMMPS input file: Calculate the shear stress(es)

units		nano
atom_style	bond

bond_style      harmonic
pair_style      none

dimension 2

read_restart       RESTART_INPUT_FILE

group crosslinkers type 2
change_box      all triclinic

neighbor        0.4 bin
neigh_modify    every 1 delay 1

variable k equal 1.380649e-2*TEMPERATURE
# variable	k equal 4.1419333334  # ag / ns^2
variable	r0 equal 0	# nm
bond_coeff * ${k} ${r0}

fix		1 all nve
fix		2 all langevin TEMPERATURE TEMPERATURE 0.005 904297
#fix		2 all temp/berendsen 300 300 0.005
fix 5 all enforce2d
fix 6 all recenter INIT INIT NULL

# compute tensile/shear stress
variable        sigt equal -pINPUT_DIR1INPUT_DIR1
compute stressA all stress/atom NULL

compute pA1 all reduce sum c_stressA[1]
compute pA2 all reduce sum c_stressA[2]
# compute pA3 all reduce sum c_stressA[3] # zz -> 0 in 2D
compute pA4 all reduce sum c_stressA[4]
# compute pA5 all reduce sum c_stressA[5] # xz -> 0 in 2D
# compute pA6 all reduce sum c_stressA[6] # yz -> 0 in 2D

# measure box length (stretch if division by at timestep 0) in direction of tension
variable lmda equal lINPUT_DIR1

# thermo_style    custom step temp press v_sigt c_pA1 c_pA2 c_pA3 c_pA4 c_pA5 c_pA6 v_lmda
# fix 7 all ave/time 5 2000 10000  v_sigt press c_pA1 c_pA2 c_pA3 c_pA4 c_pA5 c_pA6 v_lmda mode scalar ave one file SCRATCH_OUT/INPUT_DIR1/uniaxial_tension_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME-avg.out
thermo_style    custom step temp press v_sigt c_pA1 c_pA2 c_pA4 v_lmda
fix 7 all ave/time 5 2000 10000  v_sigt c_pA1 c_pA2 c_pA4 v_lmda mode scalar ave one file SCRATCH_OUT/INPUT_DIR1/uniaxial_tension_cont_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME-avg.out

thermo 500
timestep	0.0001

restart		1000000 ./output/INPUT_DIR1/deformed_restart_1_cont_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME.out ./output/INPUT_DIR1/deformed_restart_2_cont_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME.out

# dump coordinates regularly to externally calculate Rs 
dump 2 crosslinkers custom 10000 SCRATCH_OUT/INPUT_DIR1/deformed_cont_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME_phantom_crosslinker_coord_dump.lammpstrj.out id x y z ix iy iz
dump 3 all custom 500000 SCRATCH_OUT/INPUT_DIR1/deformed_cont_INPUT_ERATE_T_TEMPERATURE_INPUT_NAME_phantom_coord_dump.lammpstrj.out id type x y z ix iy iz

# final equilibration
run 1000000000 # 1e9 (stop imposed earlier, normally)
